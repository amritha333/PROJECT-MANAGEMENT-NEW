{% extends "base.html" %}
{% load static %}
{% load permissions %}
{% block content %}

<script src="https://kit.fontawesome.com/6adc82e575.js" crossorigin="anonymous"></script>


<style>
.select2-selection__choice
{ 
    color: black!important;
 
}

.grn {
    background: #ec407a !important;
}

.grn::after {
    border-left: 14px solid #ec407a !important;
}

.capital 
{
    text-transform:capitalize;
}
</style>
            <div class="content-right">
                <div class="margin-class-this">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card card-shadow">

                                <div class="card-body body-change card-border project-detailpage">
                                    <form action="update_project_details" name="update_form" method="POST" enctype="multipart/form-data">
                                        {% csrf_token %}
                                        <input type="hidden" name="sub_space_id" value="{{sub_space_id}}">
                                     
    
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div class="project-name">
                                            <h6>{{space_data.space_name}}</h6>
                                            <div class="checkbox checkbox-circle">
                                                <input id="checkbox7" type="checkbox">
                                                <label for="checkbox7" id="old_name" onmouseover="prjct_name()">
                                                    {{sub_space_data.sub_space_name}}
                                                </label>
                                                <label for="checkbox7" id="name_show"  style="display:none;">
                                                    <input type="text" name="project_name" class="form-control capital" value="{{sub_space_data.sub_space_name}}">
                                                </label>
                                       
                                            </div>
                                            {% if sub_space_data.updated_dt == None %}
                                            {% else %}

                                            <p>Last changed {{sub_space_data.updated_dt|safe}} by you</p>
                                            {% endif %}
                                        </div>
                                        <div class="d-flex">
                                            <div class="stage1">
                                                <ul class="demo-tags">
                                                {% for i in bucket_data %}
                                                    {% if i.status_name == sub_space_data.bucket_mapping_id.status_name %}
                                                    
                                                    <li><a href="#"  class="grn" >{{i.status_name}}</a></li>
                                                    {% else %}

                                                <li><a style="cursor: pointer;"  data-status-id="{{i.id}}" class=" status_click" >{{i.status_name}}</a></li>
                                                {% endif %}


                                                {% endfor %}

                                                  <!-- <li><a href="#" class="yellw">In Progress</a></li>
                                                  <li><a href="#" class="grn">Done</a></li> -->
                                                </ul>
                                            </div>



                                            <div class="d-flex">
                                                <p id="output" class="text-center"></p>

                                                <div id="controls" class="text-center">
                                                    <a href="project_tree_structure?project_id={{sub_space_data.id}}">
                                                    <button style="background-color: #7e57c2 !important;
                                                    border: 1px solid #7e57c2 !important;" type="button" class="btn btn-purple waves-effect waves-light m-b-5 save-btn"><i class="fa fa-indent mr-1"></i> Project Structure</button>&ensp;
                                                   </a>
                                                   {% if user_access_generate %}
                                                   <a target="_blank" href="{% url 'open_project' user_access_generate.slug  %}" style="padding: 12px 12px;
                                                   font-weight: bold;">Client Access Link</a>
                                                   {% else %}
                                                   <a  class="btn btn-primary m-2" data-toggle="modal" data-target="#exampleModal" style="background: #2B314E!important;
                                                   border: none!important;">Generate Client Access</a>
                                                   {% endif %}
                                                   <button type="button" data-toggle="modal" data-target="#updateModal"  class="btn btn-pink waves-effect waves-light w-md m-b-5">SAVE</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    
                                    <div class="row">
                                        
                                        <div class="col-md-5 mt-3">
                                            <div class="d-flex align-items-center assign-prjct">
                                                
                                                <img src="../static/assets/images/user-avatar.png" alt="" class="add-icn" data-toggle="dropdown" aria-expanded="false">

                                                
                                                <ul class="dropdown-menu">
                                                    <input type="text" class="form-control" placeholder="Type a name or email address">
                                                    <h6>Assigned</h6>
                                                    {% for m in sub_space_data.invite_user_details_id.all %}
                                                    <li class="assgned-emp remove_assigned_user{{m.id}}"><a  class="dropdown-item">
                                                        <div id="remove_div{{m.id}}">
                                                        <div  class="profile-image d-flex align-items-center">
                                                        <img src="./media/{{m.photo}}"><span>{{m.name}}</span>    
                                                        <span onclick="remove_function(`{{m.id}}`)" data-id="{{m.id}}" class="remove_icon"><i style="font-size: 14px;
                                                        color: #eb3939;
                                                        font-weight: bold; cursor: pointer;" class="fa fa-remove"></i></span>

                                                        </div>
                                                        </div></a>
                                                </li>
                                                    {% endfor %}
                                                   
                                                    <h6>Suggestions</h6>

                                                    {% for m in member_data %}
                             
                                                    {% if m  in sub_space_data.invite_user_details_id.all %}

                                                    {% else %}
                                                    <li class="delete_suggestion{{m.id}}"><a href="#" class="dropdown-item">
                                                        <div id="add_div{{m.id}}">
                                                        <div class="profile-image d-flex align-items-center">
                                                        <img src="./media/{{m.photo}}">  <span>{{m.name}}</span>   
                                                        
                                                        <span onclick="add_function(`{{m.id}}`,`{{m.name}}`,`./media/{{m.photo}}`)" data-id="{{m.id}}" class="add_icon"><i style="font-size: 14px;
                                                            color: #17f573;
                                                            font-weight: bold; cursor: pointer;" class="fa fa-check"></i></span>
                                                        
                                                        </div>
                                                        </div>
                                                            </a></li>
                                                    {% endif %}
                                                        
                                                  
                                                    {% endfor %}
                                                </ul> 

                                                <div class="append_user">
                                                    
                                                {% for m in sub_space_data.invite_user_details_id.all %}

                                                <div class="profile-image d-flex align-items-center m-2 save_member_data{{m.id}}">
                                                    
                                                    {% if user_details_manger.name == m.name  %}
                                                    <img class="save_member_data{{m.id}}" src="./media/{{m.photo}}">
                                                     <span class="save_member_data{{m.id}}">{{m.name}}(Manager)
                                                    {% else %}
                                                    <img class="save_member_data{{m.id}}" src="./media/{{m.photo}}">
                                                    <span class="save_member_data{{m.id}}">{{m.name}}
                                                        {%endif%}


                                                    </span>                                                      
                                                </div>
                                               
                                                {% endfor %}

                                            </div>
                                               
                                            </div>
                                           
                                          

                                            <div class="labeltag d-flex align-items-center mt-4">
                                                <img src="../static/assets/images/price-tag.png" alt="" class="label-tag">
                                                <select class="select2-selection__choice" multiple="multiple" name="tag_name"  id="myList">
                                                    
                                                    <option value="0">Add label</option>
                                                    {% for t in tags_name %}

                                                    <option value="{{t.id}}">{{t.tags_name}}</option>
                                                    {% endfor %}
                                                  </select>
                                            </div>

                                            <div class="row mt-4 prjct-form">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="field-2" class="control-label">Stage</label>
                                                        <select class="ddl-select" id="list" name="status_name">
                                                            <option selected value="{{sub_space_data.bucket_mapping_id.id}}">{{sub_space_data.bucket_mapping_id}}</option>
                                                                {% for b in bucket_data %}
                                                                    {% if sub_space_data.bucket_mapping_id.status_name == b.status_name %}

                                                                        {% else %}
                                                                        <option  value="{{b.id}}">{{b.status_name}}</option>
                                                                    {% endif %}
                                                                {% endfor %}

                                                          </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="field-2" class="control-label">Progress</label>
                                                        <select class="ddl-select-1" id="list1" name="progress">
                                                           <option selected value="{{sub_space_data.progress}}">{{sub_space_data.progress}}</option>

                                                            {% for p in progress %}
                                                            
                                                            {% if sub_space_data.progress == p.0 %}
                                                            {% else %}
                                                                <option value="{{p.0}}">{{p.0}}</option>
                                                            {% endif %}
                                                            {% endfor %}                                                               
                                                        </select>                                                             
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="field-2" class="control-label">Priority</label>
                                                        <select class="ddl-select-2" id="list2" name="priority">
                                                            <option selected value="{{sub_space_data.priority}}">{{sub_space_data.priority}}</option>
                                                            {% for p in priority %}
                                                        
                                                            {% if sub_space_data.priority == p.0 %}
                                                            {% else %}
                                                                <option value="{{p.0}}">{{p.0}}</option>
                                                            {% endif %}
                                                            {% endfor %}
                                                                                                                         
                                                        </select>                                                             
                                                    </div>
                                                      
                                                </div>

                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="field-2"
                                                            class="control-label">Planning Start Date</label>
                                                        <div class="input-group">
                                                            <input type="date" name="planning_start_date" min="{{today_date}}" value="{{sub_space_data.Planning_start_date|safe}}" class="form-control"
                                                                placeholder="" >
                                                            
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="field-2"
                                                            class="control-label">Planning Due Date</label>
                                                        <div class="input-group">
                                                            <input type="date" name="planning_end_date" min="{{today_date}}" value="{{sub_space_data.Planning_end_date|safe}}" class="form-control datepicker"
                                                                placeholder="" >
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-md-4 ">
                                                    <div class="form-group">
                                                        
                                                    </div>
                                                </div>


                                                <div class="col-md-4 ">
                                                    <div class="form-group">
                                                        <label for="field-2"
                                                            class="control-label">Actual Start Date</label>
                                                        <div class="input-group">
                                                            <input type="date" name="actual_start_date" min="{{today_date}}" value="{{sub_space_data.Actual_start_date|safe}}" class="form-control"
                                                                placeholder="" >
                                                            
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="field-2"
                                                            class="control-label">Actual Due Date</label>
                                                        <div class="input-group">
                                                            <input type="date" name="actual_end_date" min="{{today_date}}" value="{{sub_space_data.Actual_end_date|safe}}" class="form-control datepicker"
                                                                placeholder="" >
                                                        </div>
                                                    </div>
                                                </div>
                                                

                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <label for="field-2" class="control-label">Notes</label>
                                                        <textarea class="form-control" name="notes" rows="3" id="example-textarea-input" placeholder="Type a description or add notes here">{{sub_space_data.notes}}</textarea>                              
                                                    </div>
                                                      
                                                </div>

                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <label for="field-2" class="control-label mb-2">Checklist</label>
                                                        <a class="checklist_more" style="float: right;
                                                            font-size: 20px; cursor: pointer;
                                                            font-weight: bold;">+</a>
                                                        {% for ch in sub_space_data.sub_space_checklist.all %}
                                                        <div class="checkbox checkbox-circle" >
                                                            {% if ch.status == "True" %}
                                                            <input name="checkbox_checklist" checked  id="checkbox7" type="checkbox">
                                                            {% else %}
                                                            <input name="checkbox_checklist"  value="{{ch.id}}" id="checkbox7" type="checkbox">
                                                            {% endif %}

                                                            <label for="checkbox8">
                                                                {% if ch.status == "True" %}
                                                                <input  style="text-decoration: line-through;" disabled type="text" name="checklist_new" value="{{ch.milestone}}" placeholder="Add an item" class="form-control checkitem">
                                                                <h6 class="mt-2">Due date</h6>
                                                                {% if request.user.id|due_date_project_checklist:ch.id == True %}

                                                                <span name="checklist_date"  class="badge badge-size badge-pill badge-danger">{{ch.due_date|safe}}</span>
                                                                
                                                                {% else %}
                                                                <input  disabled id="due_date" type="text" name="checklist_date" value="{{ch.due_date|safe}}"  class="form-control checkitem">
                                                                {% endif %}
                                                                <div class="profile-image d-flex align-items-center m-2">
                                                                    <span class="m-2">closed by</span>
                                                                    <img src="./media/{{ch.updated_by.user_details_authuser.all.0.photo}}">
                                                                     <span class="" style="padding: 6px 13px;">
                                                                       
                                                                     <span>
                                                                        {{ch.updated_by}}
                                                                     </span>
                                                                    </span>                                           
                                                                </div>
                                                                <div class="m-2">
                                                                    <span class="m-2">closed date and time</span> 

                                                                    <span>
                                                                        {{ch.updated_dt|safe}} , {{ch.updated_tm}}
                                                                     </span>
                                                                </div>
                                                                   
                                                                      

                                                                {% else %}
                                                                <input  disabled type="text" name="checklist_new" value="{{ch.milestone}}" placeholder="Add an item" class="form-control checkitem">
                                                                <h6 class="mt-2">Due date</h6>
                                                                {% if request.user.id|due_date_project_checklist:ch.id == True %}

                                                                <span name="checklist_date"  class="badge badge-size badge-pill badge-danger">{{ch.due_date|safe}}</span>
                                                                
                                                                {% else %}
                                                                <input  disabled id="due_date" type="text" name="checklist_date" value="{{ch.due_date|safe}}"  class="form-control checkitem">
                                                                {% endif %}

                                                                <div class="profile-image d-flex align-items-center m-2">
                                                                    <span class="m-2">added by</span>
                                                                    <img class="" src="./media/{{ch.updated_by.user_details_authuser.all.0.photo}}"> <span class="" style="padding: 6px 13px;">
                                                                        
                                                                    
                                                                     <span>
                                                                        {{ch.updated_by}}
                                                                     </span>

                                                                    </span>                                                      
                                                                </div>


                                                                {% endif %}
                                                            </label>
                                                        </div>        
                                                        {% endfor %}   
                                                        
                                                        
                                                            <div class="append_add">
                                                                
                                                            </div>
                                                    </div>
                                                </div>

                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <label for="field-2" class="control-label mb-2">Attachments</label>
                                                        <div class="row">

                                                            <div class="col-4 append_attach">
                                                                {% for a in sub_space_data.sub_space_attachment.all %}
                                                                
                                                               
                                                                    {% if a.attached_file  %}
                                                                        {% if a.file_type == "link" %}

                                                                        <a target="_blank" href="{{a.attached_file}}" >
                                                                           
                                                                        {% else %}

                                                                        <a target="_blank" href="/media/{{a.attached_file}}" >
                                                                        {% endif %}
                                                                        <div  class="attach-bx d-flex "  id="hide_attach{{a.id}}">
                                                             
                                                                    <div class="d-flex align-items-center" id="atttachment{{a.id}}">
                                                                        <i class="fa fa-link" id="atttachment4{{a.id}}"></i>
                                                                    </div>
                                                                    <div class="attach-details" id="atttachment1{{a.id}}">
                                                                        {% if a.text_content == None %}
                                                                        {% else %}
                                                                        <h5>{{a.text_content}}</h5>
                                                                        {% endif %}
                                                                        <p>{{a.file_name}}</p>
                                                                    </div>
                                                                </a>
                                                                    <div class="d-flex align-items-center" id="atttachment2{{a.id}}">
                                                                        <i style="cursor: pointer;" onclick="attach_remove(`{{a.id}}`)" class="fa fa-remove" id="atttachment3{{a.id}}"></i>

                                                                        <ul class="dropdown-menu">
                                                                            <li><a href="#" class="dropdown-item">Edit</a></li>
                                                                            <li><a href="#" class="dropdown-item">Remove</a></li>
                                    
                                                                        </ul> 
                                                                    </div>
                                                                </div>
                            
                                                                {% endif %}
                                                                {% endfor %}
        
                                                            </div>
                                                            
                                                        </div>

                                                        <div class="dropright">
                                                            <div class="add-attach mt-4" data-toggle="dropdown" aria-expanded="false">
                                                                Add attachment
                                                        </div> 
                                                       
                                                        <ul class="dropdown-menu">
                                                            <li><a href="#" class="dropdown-item"><input style="padding:12px 12px ;" type="file" multiple name="attachment_new">From Computer</a></li>
                                                            <li><a class="dropdown-item"><input class="form-control" type="text" name="attach_name"></a></li>
                                                            <li><a href="#" class="dropdown-item" style="cursor: pointer;" data-toggle="modal" data-target="#url-modal">A link to a URL</a></li>
                    
                                                        </ul>     
                                                        </div>


                                                    </div>
                                                      
                                                </div>
                                       
                                            </div>
                                            
                                        </div>


                                        <div id="url-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h4 class="modal-title mt-0">Add a link</h4>
                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <div class="form-group url-inpt">
                                                                    <label for="field-1" class="control-label">Address</label>
                                                                    <div class="input-group">
                                                                        
                                                                        <input type="url" name="link_address" class="form-control" id="field-1" placeholder="Add your link here">
                                                                       
                                                                    </div>
                                                                </div>
                                                            </div>
                                                           
                                                            <div class="col-md-12">
                                                                <div class="form-group">
                                                                    <label for="field-1" class="control-label">Text to display</label>
                                                                    <input type="text" name="text_content" class="form-control" id="field-1" placeholder="Give your link name here">
                                                                </div>
                                                            </div>
                                        
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <!-- <button type="button" style="background-color:#f9365f!important;border: none!important;" class="btn btn-info waves-effect waves-light">Add </button> -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </form>

                                        <div class="col-md-7 timesheet-tab mt-3">
                                                <ul class="nav nav-tabs tabs" role="tablist" style="width: 100%;">
                                                    <li class="nav-item tab">
                                                        <a class="nav-link active" id="home-tab-2" data-toggle="tab" href="#home-2" role="tab" aria-controls="home-2" aria-selected="false">
                                                            <span class="d-block d-sm-none"><i class="fa fa-home"></i></span>
                                                            <span class="d-none d-sm-block">Task</span>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item tab">
                                                        <a class="nav-link" id="profile-tab-2" data-toggle="tab" href="#profile-2" role="tab" aria-controls="profile-2" aria-selected="true">
                                                            <span class="d-block d-sm-none"><i class="fa fa-user"></i></span>
                                                            <span class="d-none d-sm-block">Comments</span>
                                                        </a>
                                                    </li>

                                                    <li class="nav-item tab">
                                                        <a class="nav-link" id="message-tab-2" data-toggle="tab" href="#message-2" role="tab" aria-controls="message-2" aria-selected="false">
                                                            <span class="d-block d-sm-none"><i class="fa fa-envelope-o"></i></span>
                                                            <span class="d-none d-sm-block">Time Sheet</span>
                                                        </a>
                                                    </li>
                                                    
                                                    
                                                </ul>
                                                <div class="tab-content">
                                                    <div class="tab-pane show active" id="home-2" role="tabpanel" aria-labelledby="home-tab-2">

                                                        <table id="datatable" class="table table-striped dt-responsive table-bordered nowrap table-padd" style="border-collapse: collapse; border-spacing: 0; width: 100%;">

                                                            <thead class="border-class">
    
                                                                <tr class="heading-text">
                                                                    <th>Task title</th>
                                                                    <th>Assigned to</th>                                                                         
                                                                    <th>Due</th>
                                                                    <th>Bucket</th>
                                                                    <th></th>
                                                                </tr>
                                                            </thead>
    
    
                                                            <tbody class="body-textcls vertcle-center">
                                                               
                                                                <tr>
                                                                    <td colspan="5" class="addlinetd">
                                                                        <a style="cursor: pointer;" data-subspace-id="{{sub_space_data.id}}" data-space-id="{{space_data.id}}"  class="addline create_task"><i class="md md-add-circle"></i> Add Task</a>
                                                                    </td>
                                                                </tr>
                                                                {% for i in task_data %}
                                                                
                                                                {% if request.user in i.invite_user_auth_id.all %} 
                                                            
                                                                <tr>
                                                                    <td>
    
                                                                        <div class="checkbox margin-check checkbox-primary checkbox-circle">
                                                                            <input id="checkbox-9" type="checkbox" class="padd-radio">
                                                                            <label for="checkbox-9">
                                                              
                                                                            </label>
                                                                            <p class="main-head">
                                                                                <a style="cursor:pointer ;" href="view_task_page?task_id={{i.id}}&parent_id={{sub_space_data.id}}&status=task">{{i.task_name}}</a></p>
                                                                        </div>
    
                                                                    </td>
                                                                    <td>
                                                                        <div class="profile-image d-flex align-items-center">
                                                                            {% for j in i.invite_user_details_id.all %}
                                                                            <img src="./media/{{j.photo}}">
                                                                            {% endfor %}
                                                                            
                                                                           
                                                                          
                                                                        </div>
                                                                    </td>
                                                                   
                                                                    <td>
                                                                        {% if request.user.id|due_date_check_task:i.id == True %}
                                                                        <span  class="badge badge-size badge-pill badge-danger"><i class="ion-calendar"></i>&ensp;{{i.end_date|safe}}</span>

                                                                        {% else %}
                                                                        <i class="ion-calendar"></i>&ensp;{{i.end_date|safe}}

                                                                        {% endif %}
                                                                    </td>
                                                                    <td>
                                                                        <span style="background-color: {{i.bucket_mapping_id.status_color}};"   class="badge badge-size badge-pill">{{i.bucket_mapping_id}}</span>
                                                
                        
                                                                    </td>
                                                         
                                                                    <td class="d-flex justify-content-end align-items-center text-right">

                                                                        <a href="view_task_page?task_id={{i.id}}&parent_id={{sub_space_data.id}}&status=task" class="viewtasklink"><i class="fa fa-eye"></i> View Task</a>
    
                                                                        <button type="button" class="btn btn-more-data waves-effect waves-light" data-toggle="dropdown" aria-expanded="false">
                                                                            <i class="md-more-vert"></i>
                                                                    </button>
                                                                        <ul class="dropdown-menu">
                                                                            <li><a href="#" class="dropdown-item">Edit</a></li>
                                                                            <li><a href="#" class="dropdown-item">Delete</a></li>
                                                                        </ul>
    
                                                                    </td>
                                                                </tr>

                                                                {% elif request.user.user_details_authuser.all.0.user_type == 'company_admin' %}
                                                                
                                                                <tr>
                                                                    <td>
    
                                                                        <div class="checkbox margin-check checkbox-primary checkbox-circle">
                                                                            <input id="checkbox-9" type="checkbox" class="padd-radio">
                                                                            <label for="checkbox-9">
                                                              
                                                                            </label>
                                                                            <p class="main-head">
                                                                                <a style="cursor:pointer ;" href="view_task_page?task_id={{i.id}}&parent_id={{sub_space_data.id}}&status=task">{{i.task_name}}</a></p>

                                                                        </div>
    
                                                                    </td>
                                                                    <td>
                                                                        <div class="profile-image d-flex align-items-center">
                                                                            {% for j in i.invite_user_details_id.all %}
                                                                            <img src="./media/{{j.photo}}">
                                                                            {% endfor %}
                                                                           
                                                                           
                                                                          
                                                                        </div>
                                                                    </td>
                                                                   
                                                                    <td>
                                                                        {% if request.user.id|due_date_check_task:i.id == True %}
                                                                        <span  class="badge badge-size badge-pill badge-danger"><i class="ion-calendar"></i>&ensp;{{i.end_date|safe}}</span>

                                                                        {% else %}
                                                                        <i class="ion-calendar"></i>&ensp;{{i.end_date|safe}}

                                                                        {% endif %}
                                                                    </td>
                                                                    <td>
                                                                        <span style="background-color: {{i.bucket_mapping_id.status_color}};"   class="badge badge-size badge-pill">{{i.bucket_mapping_id}}</span>
                                                
                        
                                                                    </td>
                                                         
                                                                    <td class="d-flex justify-content-end align-items-center text-right">

                                                                        <a href="view_task_page?task_id={{i.id}}&parent_id={{sub_space_data.id}}&status=task" class="viewtasklink"><i class="fa fa-eye"></i> View Task</a>
    
                                                                        <button type="button" class="btn btn-more-data waves-effect waves-light" data-toggle="dropdown" aria-expanded="false">
                                                                            <i class="md-more-vert"></i>
                                                                    </button>
                                                                        <ul class="dropdown-menu">
                                                                            <li><a href="#" class="dropdown-item">Edit</a></li>
                                                                            <li><a href="#" class="dropdown-item">Delete</a></li>
                                                                        </ul>
    
                                                                    </td>
                                                                </tr>
                                                                {% endif %}
                                                                
                                                               {% endfor %}
                                                    </tbody>
                                                        </table>

                                                    </div>
                                                    <div class="tab-pane" id="profile-2" role="tabpanel" aria-labelledby="profile-tab-2" style="display: none;">
                                                        <div class="row prjct-form">
                                                            <div class="col-md-12">
                                                                <div class="form-group mt-2">
                                                                    <!-- <label for="field-2" class="control-label">Comments</label> -->
                                                                    <textarea class="form-control" rows="3" id="project_comment" placeholder="Type your message here"></textarea>                              
                                                                </div>
                                                                <button type="button" id="commnt_snd" class="btn btn-pink waves-effect waves-light w-sm m-b-5 float-right">Send</button>
                                                            </div>

                                                            {% for c in sub_space_data.sub_space_comments.all %}
                                                            <div class="col-md-12 comment-sec">
                                                                <div class="d-flex align-items-center">
                                                                    
                                                                    <div class="col px-0 pro-detail">
                                                                        <img src="./media/{{c.added_by.photo}}" alt=""style="width: 34px;
                                                                        height: 34px;
                                                                        object-fit: cover;
                                                                        border-radius: 100%;
                                                                        margin-right: -12px;"
                                                                        class="avatar lg rounded-circle">&ensp;&ensp;&ensp;
                                                                       {{c.added_by.name}}
                                                                    </div>
                                                                    <div class="col px-0">
                                                                        <span>{{c.created_dt}} {{c.created_tm}}</span>
                                                                    </div>
                                                                </div>
                                                                <p>{{c.comments}}</p>
                                                            </div>
                                                            {% endfor %}

                                                        </div>
                                                    </div>
                                                    <div class="tab-pane" id="message-2" role="tabpanel" aria-labelledby="message-tab-2" style="display: none;">
                                                        <table id="datatable" class="table dt-responsive table-bordered nowrap table-padd time-sheet" style="border-collapse: collapse; border-spacing: 0; width: 100%;">

                                                            <thead class="border-class">
    
                                                                <tr class="heading-text">
                                                                    <th>Date</th>
                                                                    <th>Employee</th>
                                                                    <th>Task name</th>
                                                                    <th>Hour Spent</th>                                                           
                                                                    <th></th>
                                                                </tr>
                                                            </thead>
    
                                                            <tbody class="body-textcls vertcle-center">
                                                                {% for h in time_details %}
                                                                {% if h.counter == None %}
                                                                    {% else %}
                                                                <tr>
                                                                   
                                                                    <td > {{h.current_date|safe}}</td>
                                                                    <td>
                                                                        <div class="profile-image d-flex align-items-center">
                                                                           
                                                                            <img src="../static/assets/images/users/avatar-4.jpg">
                                                                               <span>{{h.user_details_id.name}}</span> 
                                                                        </div>
                                                                    </td>
                                                                    <td>{{h.task_id.task_name}}</td>
                                                                    <td>{{h.counter|safe}}</td>                                                               
                                                                    <td><i class="fa-regular fa-trash-can"></i></td>
                                                                </tr>
                                                              <tr>
                                                                <td colspan="4" style="border: none!important;    " >
                                                                    <a class=" " data-toggle="collapse" href="#collapseExample{{forloop.counter}}" role="button" aria-expanded="false" aria-controls="collapseExample">
                                                                        <i style="    color: #2b314e;
                                                                        font-weight: bold;
                                                                        font-size: 12px;" class="fas fa-arrow-down"></i>
                                                                      </a>
                                                                </td>
                                                              </tr>
                                                             
                                                              <tr> 
            
                                                                <td colspan="4">
                                                                    <div class="collapse" id="collapseExample{{forloop.counter}}">
                                                                        <div class="card card-body">
                                                                         <table id="datatable" class="table dt-responsive table-bordered nowrap table-padd time-sheet" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                                            <tr>
                                                                                <td>
                                                                                    S/No
                                                                                </td>
                                                                                <td>
                                                                                    Start Time
                                                                                </td>
                                                                                <td>
            
                                                                                </td>
                                                                                <td>
                                                                                    End Time
                                                                                </td>
                                                                                <td>
                                                                                    Total
                                                                                </td>
                                                                            </tr>
                                                                            {% for j in h.history_task_time_id.all %}
            
                                                                            <tr>
                                                                                <td>
                                                                                    {{forloop.counter}}
            
                                                                                </td>
                                                                                <td>
                                                                                    {{j.starting_time}}
                                                                                </td>
                                                                                <td>
                                                                                    <i style="color: #ec407a;
                                                                                    font-weight: bold;" class="fa-solid fa-arrow-right"></i>
                                                                                </td>
                                                                                <td>
                                                                                    {{j.end_time}}
                                                                                </td>
                                                                                <td>
                                                                                    {{j.counter|safe}}
                                                                                </td>
                                                                            </tr>
                                                                            {% endfor %}
                                                                         </table>
                                                                        </div>
                                                                </td>
                                                              </div>
                                                               
                                                              </tr>
                                                           
                                                               
                                                              
                                                                {% endif %}
                                                                {% endfor %}
                                                            </tbody>
                                                        </table>

                                                        <div class="d-flex hours-spent">
                                                            <div class="col-md-6 t-hr">
                                                                <!-- <h5>Total hours spent : <span>{{total_hr}}</span></h5> -->
                                                            </div>
            
                                                            <div class="col-md-6 r-hr text-right">
                                                                <h5>Total hours spent :  <span>{{total_hr}}</span></h5>
                                                            </div>
                                                            <!-- <div class="col-md-6 r-hr text-right">
                                                                <h5>Remaining hours : <span>00:00</span></h5>
                                                            </div> -->
                                                        </div>
                                                    </div>
                                                </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

 

        </div>
    </div>
</div>


<form name="task_form" class="task_class" method="POST" action="task_management_action" enctype="multipart/form-data">
    {% csrf_token %} 

<div id="new_task_create" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none">
    <div class="modal-dialog  modal-lg"> 
        <div class="modal-content"> 
            <div class="modal-header">
                <h4 class="modal-title mt-0" style="color: #f9365f;
                font-weight: bold;">Create New Task</h4> 
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div> 
            <div class="modal-body"> 
                <input type="hidden" id="sub_space_id1" name="sub_space_id">
                <input type="hidden" id="space_id1" name="space_id">
                <div class="row"> 
                    <div class="col-md-6"> 
                        <div class="form-group"> 
                            <label for="field-1" class="control-label">Task Name</label> 
                            <input type="text" required name="task_name" class="form-control capital" id="field-1" placeholder="Task Name"> 
                        </div> 
                    </div> 
                  
                    <div class="col-md-6"> 
                        <div class="form-group"> 
                            <label for="field-2" class="control-label">Bucket</label> 
                            <div id="bucket_append">
                                <select class="form-control" name="bucket">
                                    {% for b in bucket_data %}
                                    <option  value="{{b.id}}">{{b.status_name}}</option>
                                    {% endfor %}
                                 </select>
                            </div>
                        </div> 
                    </div> 
                    <div class="col-md-6"> 
                        <div class="form-group"> 
                            <label for="field-2" class="control-label">Progress</label> 
                            <select class="form-control" name="progress">
                                <option value="Not Started" selected="">Not Started</option>
                                <option value="In progress">In progress</option>
                                <option value="Completed">Completed</option>
                            </select>
                        </div> 
                    </div> 

                    <div class="col-md-6"> 
                        <div class="form-group"> 
                            <label for="field-2" class="control-label">Priority</label> 
                         <select class="form-control"  name="priority">
                            <option value="Urgent" selected="">Urgent</option>
                            <option value="Important">Important</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                         </select>
                        </div> 
                    </div> 

                    <div class="col-md-6"> 
                        <div class="form-group"> 
                            <label for="field-2" class="control-label"> Start date</label> 
                            <input type="date" name="start_date" value="{{today_date|safe}}" min="{{today_date}}" class="form-control">
                        </div> 
                    </div> 
                    <div class="col-md-6"> 
                        <div class="form-group"> 
                            <label for="field-2" class="control-label"> End date</label> 
                         <input type="date" required  min="{{today_date}}" name="end_date" class="form-control">
                        </div> 
                    </div> 


                    <div class="col-md-6"> 
                        <div class="form-group"> 
                            <label for="field-2" class="control-label">Checklist</label>
                            <a id="add_checklist" style="float: right;
                            font-size: 18px; cursor: pointer;
                            font-weight: bold;">+</a>
                            <input type="text" name="checklist" class="form-control">

                            <label for="field-2" class="control-label mt-2">Checklist Duedate</label>
                            <input type="date" min="{{today_date}}" name="checklist_end_date"   class="form-control">

                    
                            <div class="" id="new_checklist" style="display:none;">
                                <div class="checklist_add">
                                    <label for="field-2" class="control-label mt-4">Checklist</label>
                                    <input class="form-control"  type="text" name="checklist"> 
                                    <label for="field-2" class="control-label mt-2">Checklist Duedate</label>
                                    <input type="date" min="{{today_date}}" name="checklist_end_date"   class="form-control ">

                                    
                                </div>
                                <a href="#" class="add_check_list" style="text-decoration: none;"><i class="fa fa-plus"></i></a>
                            </div>
                        </div> 
                    </div> 



                    <div class="col-md-12"> 
                        <div class="form-group"> 
                            <label for="field-2" class="control-label">Attachments </label> 
                            
                            <div class="input-group uploadFile1">
                           
                                <input type="file" multiple class="inputfile form-control" name="attached_file" >
                                <div class="input-group-append">
                                    <span class="input-group-text"> <i class="fas fa-paperclip"></i></span>
                                </div>
                            </div>
                        </div> 
                    </div> 


                    

                    <div class="col-md-12"> 
                        <div class="form-group"> 
                            <label for="field-2" class="control-label">Comments</label> 
                         <input type="text" name="comments" class="form-control">
                        </div> 
                    </div> 
                 
                    <div class="col-md-12"> 
                        <div class="form-group"> 
                            <label for="field-2" class="control-label">Note</label> 
                         <input type="text" name="notes" class="form-control">
                        </div> 
                    </div> 


                    <div class="col-md-12"> 
                        <div class="form-group"> 
                            <label for="field-2" class="control-label">Assignees</label> 
                            <select required multiple class="form-control jsSelect1" name="member_checkbox">
                                <option value="1">select</option>
                                {% for i in sub_space_data.invite_user_details_id.all %}
                                <option value="{{i.id}}"> {{i.name}}</option>
                                {% endfor %}
                             </select>                        
                        </div> 
                    </div> 




                   
                    <!-- <div class="img-group mx-2" style="float: right;">
                        <a  data-toggle="modal" data-target="#task_employee">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user-plus topbar-icon invt"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg></a>
                           
                            <div style="color: red; display:none ;" id="message"></div>
                    
                        </div> -->
                </div> 
            </div> 
            <div class="modal-footer"> 
                <button type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">Close</button> 
                <button type="submit" style="background-color:#f9365f!important;border: none!important;" class="btn btn-info waves-effect waves-light">Save</button> 
            </div> 
        </div> 
    </div>
</div><!-- /.modal -->






</form>

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Generate Link</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Confirmation...
        </div>
        <form action="generate_client_access_link" method="POST">
            {% csrf_token %}
            <input type="hidden" name="access_id" value="{{sub_space_data.id}}">
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Generate</button>
        </div>
    </form>
      </div>
    </div>
  </div>


  <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmModalLabel">Are you sure you want to confirm?</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Confirmation...
        </div>
        <form action="update_project_status" method="POST">
            {% csrf_token %}
            <input type="hidden" name="status_id" id="status_id" >
            <input type="hidden" name="project_id" value="{{sub_space_data.id}}" >

       
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Confirm</button>
        </div>
        </form>
    
      </div>
    </div>
  </div>


  <div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="updateModalLabel">Are you sure you want to update details?</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Confirmation...
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary update_click">Confirm</button>
        </div>
    </form>
      </div>
    </div>
  </div>






{% block scripts %}

<script>
    var colors = ["red", "blue", "green", "orange", "yellow"];

    $(document).ready(function () {
        var checkList = [0];
        var selectedValuesTest = `{{tag_data}}`
        parsedTest = JSON.parse(selectedValuesTest); 
        $("#myList").select2({
            width: "100%",
            templateSelection: function (data, container) {
                var selection = $('#myList').select2('data');
                var idx = selection.indexOf(data);
                console.log(">>Selection", data.text, data.idx, idx);
                data.idx = idx;

                // $(container).css("background-color", colors[data.idx]);
                return data.text;
            },
        }).val(checkList).trigger("change");
        $('#myList').val(parsedTest).trigger('change');

    })
</script>

<script>
    $(function () {
        $(".ddl-select, .ddl-select-1, .ddl-select-2, .ddl-select-3").each(function () {
            $(this).hide();
            var $select = $(this);
            var _id = $(this).attr("id");
            var wrapper = document.createElement("div");
            wrapper.setAttribute("class", "ddl ddl_" + _id);

            var input = document.createElement("input");
            input.setAttribute("type", "text");
            input.setAttribute("class", "ddl-input");
            input.setAttribute("id", "ddl_" + _id);
            input.setAttribute("readonly", "readonly");
            input.setAttribute(
                "placeholder",
                $(this)[0].options[$(this)[0].selectedIndex].innerText
            );

            $(this).before(wrapper);
            var $ddl = $(".ddl_" + _id);
            $ddl.append(input);
            $ddl.append("<div class='ddl-options ddl-options-" + _id + "'></div>");
            var $ddl_input = $("#ddl_" + _id);
            var $ops_list = $(".ddl-options-" + _id);
            var $ops = $(this)[0].options;
            for (var i = 0; i < $ops.length; i++) {
                $ops_list.append(
                    "<div data-value='" +
                    $ops[i].value +
                    "'>" +
                    $ops[i].innerText +
                    "</div>"
                );
            }

            $ddl_input.click(function () {
                $ddl.toggleClass("active");
            });
            $ddl_input.blur(function () {
                $ddl.removeClass("active");
            });
            $ops_list.find("div").click(function () {
                $select.val($(this).data("value")).trigger("change");
                $ddl_input.val($(this).text());
                $ddl.removeClass("active");
            });
        });
    });
</script>

<script>
jQuery(document).ready(function() {

    // Tags Input
    jQuery('#tags').tagsInput({
        width: 'auto'
    });

    // Time Picker
    jQuery('#timepicker').timepicker({
        defaultTIme: false
    });
    jQuery('#timepicker2').timepicker({
        showMeridian: false
    });
    jQuery('#timepicker3').timepicker({
        minuteStep: 15
    });

    // Date Picker
    jQuery('.datepicker').datepicker();
    jQuery('#datepicker-inline').datepicker();
    jQuery('#datepicker-multiple').datepicker({
        numberOfMonths: 3,
        showButtonPanel: true
    });
   
});
</script>
<script>
var time = 0;
var running = 0;

function startPause() {
if (running == 0) {
    running = 1;
    increment();
    document.getElementById("startPause").innerHTML = "STOP";
} else {
    running = 0;
    document.getElementById("startPause").innerHTML = "START";
}
}

function reset(){
running = 0;
time = 0;
document.getElementById("startPause").innerHTML = "START";
document.getElementById("output").innerHTML = "00:00:00";
}

function increment() {
if (running == 1) {
    setTimeout(function() {
        time++;
        var mins = Math.floor(time/10/60);
        var secs = Math.floor(time/10 % 60);
        var tenths = time % 10;
        if (mins < 10) {
          mins = "0" + mins;
        } 
        if (secs < 10) {
          secs = "0" + secs;
        }
        document.getElementById("output").innerHTML = mins + ":" + secs + ":" + "0" + tenths;
        increment();
    },100);
}
}
</script>


<script>
    $(document).ready(function() {
              $('.jsSelect1').select2({
            placeholder: 'Select an option'
        });
           
    });


    var colors = ['#2b314e;', '#f89a4d;', '#129556'];
    $('.t_status').each(function(){
       
            var randomColor = Math.floor(Math.random() * colors.length)
            $(this).css('background-color', colors[randomColor])
    })


</script>


<script>
    $(".create_task").click(function(){
    var sub_space_id = $(this).attr("data-subspace-id")
    var space_id = $(this).attr("data-space-id")
    $("#sub_space_id1").val(sub_space_id)
    $("#space_id1").val(space_id)
    $("#new_task_create").modal("show")
    $.ajax(
    {
        type:"GET",
        url: "get_bucket_details",
        data:{
            space_id: space_id
        },
        success: function( data ) 
        {
            $("#bucket_append").empty().append(data)
        }
     });
    })
</script>


<script>
    $("#add_checklist").click(function(){
       
        $("#new_checklist").show()
        $("#add_checklist").hide()
    })
   
    $(".add_check_list").click(function(){
        
        $('.checklist_add').append('<label for="field-2" class="control-label mt-4">Checklist</label><input class="form-control" type="text" name="checklist"><label for="field-2" class="control-label mt-2">Checklist Duedate</label><input type="date" min="{{today_date}}" name="checklist_end_date"  class="form-control">');
                              
    })
    </script>

    <script>
        $(".checklist_more").click(function(){
        $('.append_add').append(` <div class="checkbox checkbox-circle mt-2" ><input  id="checkbox73" type="checkbox"><label for="checkbox73"><input name="checklist_new" type="text" placeholder="Add an item" class="form-control checkitem"><input type="date" name="checklist_date" placeholder="Checklist due date"  class="form-control checkitem">
        </label></div>`);
        })
    </script>

    <script>
        function prjct_name(){

            $('#name_show').show();
            $('#old_name').hide();

        }
        function old_prjct(){
            $('#name_show').hide();
            $('#old_name').show();
        }


    </script>

<script>

$("#commnt_snd").click(function(){

    comments = $('#project_comment').val()
   
    $.ajax(
    {
        type:"GET",
        url: "get_project_comment",
        data:{
            sub_space_id: `{{sub_space_id}}`,
            comments : comments
        },
        success: function( data ) 
        {
            var comment = document.getElementById("project_comment");
            comment.value = "";
            window.location.reload();
        }
     });
})



$(".status_click").click(function(){

    var status_id = $(this).attr("data-status-id")
    $("#status_id").val(status_id)
    $("#confirmModal").modal("show")

})


$(".update_click").click(function(){
    document.forms["update_form"].submit();


})


function add_function(value,name,img){
    $(".append_user").append(` <div class="profile-image d-flex align-items-center m-2">
        <input type="hidden" name="add_new_memember_list" value=`+value+`>
                                                    <img src=`+img+`> <span>`+name+`</span>                                                      
                                                </div>`)
    $(".delete_suggestion"+value).hide()
}


function remove_function(value){

    $(".append_user").append(`<input type="hidden" name="remove_assign_user[]" value=`+value+`>`)
    $(".remove_assigned_user"+value).hide()
    $(".save_member_data"+value).hide()
    
}


function attach_remove(value){

    $(".append_attach").append(`<input type="hidden" name="remove_attachment[]" value=`+value+`>`)

    document.getElementById("hide_attach"+value).style.background = "#f000"; 
    document.getElementById("hide_attach"+value).style.border = "none"; 
    $("#atttachment"+value).hide()
    $("#atttachment1"+value).hide()
    $("#atttachment2"+value).hide()
    $("#atttachment3"+value).hide()
    $("#atttachment4"+value).hide()

}


    </script>




{% endblock %}

{% endblock %}



